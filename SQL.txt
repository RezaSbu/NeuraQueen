-- راهنمای جامع دیتابیس
-- این کدها را کپی کرده و در بخش SQL Editor در داشبورد Supabase اجرا کنید.

-- 1. ساخت جدول کاربران (users)
CREATE TABLE IF NOT EXISTS users (
  user_id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  number TEXT UNIQUE NOT NULL,
  username TEXT UNIQUE NOT NULL,
  name TEXT,
  last_name TEXT,
  pass TEXT NOT NULL,
  signup_Date TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

-- 2. ساخت جدول نشست‌های چت (chat_sessions)
CREATE TABLE IF NOT EXISTS chat_sessions (
  id TEXT PRIMARY KEY,
  user_id UUID REFERENCES users(user_id) ON DELETE CASCADE,
  title TEXT,
  messages JSONB,
  last_modified TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
ALTER TABLE chat_sessions ENABLE ROW LEVEL SECURITY;

-- ایجاد ایندکس
CREATE INDEX IF NOT EXISTS idx_chat_sessions_user_id ON chat_sessions(user_id);

-- 3. ساخت جدول ادمین (admins)
CREATE TABLE IF NOT EXISTS admins (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  username TEXT UNIQUE NOT NULL,
  pass TEXT NOT NULL
);
ALTER TABLE admins ENABLE ROW LEVEL SECURITY;









CREATE TABLE IF NOT EXISTS public.admins (
    id SERIAL PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    pass TEXT NOT NULL
);



INSERT INTO public.admins (username, pass)
VALUES ('Admin', 'Admin')
ON CONFLICT (username) DO NOTHING;



ALTER TABLE public.admins ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Enable read access for admins"
ON public.admins
FOR SELECT
TO anon
USING (true);
